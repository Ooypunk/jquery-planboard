/*
UriTemplates Draft 0.6  Template Processor
(c) marc.portier@gmail.com - 2011-2012
Distributed under ALPv2 
*/var uritemplate=function(){function a(a){return typeof a=="function"}function b(a){for(var b in a)return!1;return!0}function c(a,b){for(var c in b)a[c]=b[c];return a}function d(a){this.raw=a,this.cache={}}function e(a){this.set=a}function f(a){this.txt=a}function h(a){return encodeURIComponent(a).replace(g,function(a){return escape(a)})}function i(a){return encodeURI(a)}function j(a,b,c){return b+(b.length>0?"=":"")+c}function k(a,b,c,d){d=d||!1,d&&(a="");if(!b||b.length===0)b=a;return b+(b.length>0?"=":"")+c}function l(a,b,c,d){d=d||!1,d&&(a="");if(!b||b.length===0)b=a;return b+(b.length>0&&c?"=":"")+c}function u(a,b){c(this,a),this.vars=b}function w(a){this.str="",a===v?this.appender=w.UnboundAppend:(this.len=0,this.limit=a,this.appender=w.BoundAppend)}function x(a,b,c){var d=new w(c),e="",f=0,g=a.length;for(f=0;f<g;f++)a[f]!==null&&a[f]!==undefined&&(d.append(e).append(a[f],b),e=",");return d.str}function y(a,b,c){var d=new w(c),e="",f;for(f in a)a.hasOwnProperty(f)&&a[f]!==null&&a[f]!==undefined&&(d.append(e+f+",").append(a[f],b),e=",");return d.str}function z(a,b,c,d,e){var f;if(c.isArr)f=x(b,d,a.maxLength);else if(c.isObj)f=y(b,d,a.maxLength);else{var g=new w(a.maxLength);f=g.append(b,d).str}e("",f)}function A(a,b,c,d,e){if(c.isArr){var f=0,g=b.length;for(f=0;f<g;f++)e("",d(b[f]))}else if(c.isObj){var h;for(h in b)b.hasOwnProperty(h)&&e(h,d(b[h]))}else e("",d(b))}function B(a){var c=!1,d=!1,e=!0;return a!==null&&a!==undefined&&(c=a.constructor===Array,d=a.constructor===Object,e=c&&a.length===0||d&&b(a)),{isArr:c,isObj:d,isUndef:e}}function C(a,b,c){this.name=unescape(a),this.valueHandler=b,this.maxLength=c}d.prototype.get=function(b){var c=this.lookupRaw(b),d=c;if(a(c)){var e=this.cache[b];e!==null&&e!==undefined?d=e.val:(d=c(this.raw),this.cache[b]={key:b,val:d})}return d},d.prototype.lookupRaw=function(a){return d.lookup(this,this.raw,a)},d.lookup=function(a,b,c){var e=b[c];if(e!==undefined)return e;var f=c.split("."),g=0,h=f.length-1;for(g=0;g<h;g++){var i=f.slice(0,h-g).join("."),j=f.slice(-g-1).join("."),k=b[i];if(k!==undefined)return d.lookup(a,k,j)}return undefined},e.prototype.expand=function(a){var b=new d(a),c="",e=0,f=this.set.length;for(e=0;e<f;e++)c+=this.set[e].expand(b);return c},f.prototype.expand=function(){return this.txt};var g=new RegExp("[:/?#\\[\\]@!$&()*+,;=']","g"),m={prefix:"",joiner:",",encode:h,builder:j},n={prefix:"",joiner:",",encode:i,builder:j},o={prefix:"#",joiner:",",encode:i,builder:j},p={prefix:";",joiner:";",encode:h,builder:l},q={prefix:"?",joiner:"&",encode:h,builder:k},r={prefix:"&",joiner:"&",encode:h,builder:k},s={prefix:"/",joiner:"/",encode:h,builder:j},t={prefix:".",joiner:".",encode:h,builder:j};u.build=function(a,b){var c;switch(a){case"":c=m;break;case"+":c=n;break;case"#":c=o;break;case";":c=p;break;case"?":c=q;break;case"&":c=r;break;case"/":c=s;break;case".":c=t;break;default:throw"Unexpected operator: '"+a+"'"}return new u(c,b)},u.prototype.expand=function(a){var b=this.prefix,c=this.joiner,d=this.builder,e="",f=0,g=this.vars.length;for(f=0;f<g;f++){var h=this.vars[f];h.addValues(a,this.encode,function(a,f,g){var i=d(h.name,a,f,g);i!==null&&i!==undefined&&(e+=b+i,b=c)})}return e};var v={};w.prototype.append=function(a,b){return this.appender(this,a,b)},w.UnboundAppend=function(a,b,c){return b=c?c(b):b,a.str+=b,a},w.BoundAppend=function(a,b,c){return b=b.substring(0,a.limit-a.len),a.len+=b.length,b=c?c(b):b,a.str+=b,a},C.build=function(a,b,c,d){var e,f;return b?e=A:e=z,c||(d=v),new C(a,e,d)},C.prototype.addValues=function(a,b,c){var d=a.get(this.name),e=B(d);if(e.isUndef)return;this.valueHandler(this,d,e,b,c)};var D=/([^*:]*)((\*)|(:)([0-9]+))?/,E=function(a){var b=a[1],c=a[3],d=a[4],e=parseInt(a[5],10);return C.build(b,c,d,e)},F=",",G=/(\{([+#.;?&\/])?(([^.*:,{}|@!=$()][^*:,{}$()]*)(\*|:([0-9]+))?(,([^.*:,{}][^*:,{}]*)(\*|:([0-9]+))?)*)\})/g,H=function(a){var b=a[0],c=a[2]||"",d=a[3].split(F),e=0,f=d.length;for(e=0;e<f;e++){var g;if((g=d[e].match(D))===null)throw"unexpected parse error in varspec: "+d[e];d[e]=E(g)}return u.build(c,d)},I=function(a,b,c,d){if(c<d){var e=b.substr(c,d-c);a.push(new f(e))}},J=function(a){var b=0,c=[],d,f=G;f.lastIndex=0;while((d=f.exec(a))!==null){var g=d.index;I(c,a,b,g),c.push(H(d)),b=f.lastIndex}return I(c,a,b,a.length),new e(c)};return J}();