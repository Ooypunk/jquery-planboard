<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<HTML LANG="nl">
<HEAD>
  <TITLE>jquery-planBoard test and demo page</TITLE>
  
  <link type="text/css" rel="stylesheet"      href="./css/jquery-ui-1.8.18.custom.css"    media="all" />
  <link type="text/css" rel="stylesheet"      href="./css/jquery.jscrollpane.css"         media="all" />
  <link type="text/css" rel="stylesheet"      href="./css/jquery.jscrollpane.lozenge.css" media="all" />
  <link type="text/css" rel="stylesheet"      href="./css/demo.css"                       media="all" />
  <link type="text/css" rel="stylesheet/less" href="./css/jquery.planboard.less"          media="all" />

  <script type="text/javascript" src="./js/less-1.2.1.min.js"></script>

  <script type="text/javascript" src="./js/jquery-1.7.1.min.js" ></script>
  <script type="text/javascript" src="./js/jquery-ui-1.8.18.custom.min.js"></script>
  <script type="text/javascript" src="./js/jquery.ui.datepicker-fr.js"></script>
  <script type="text/javascript" src="./js/jquery.ui.datepicker-nl.js"></script>

  <script type="text/javascript" src="./js/jquery.mousewheel.js"></script>
  <script type="text/javascript" src="./js/jquery.jscrollpane.js"></script>
  
  <script type="text/javascript" src="../../main/js/jquery-planboard.js" ></script>
  
  <script type="text/javascript" >
    ;(function($) {
    
        var hideContext;
        hideRowsTool = function(api, $tool) {
            var me = this;
            
            function showSelectors() {

                api.eachRow( function(api, row)  {
                    var $s = $("<input type='checkbox'>");
                    $s.data('row', row);
                    var $d = $("<div style='position: absolute; left: 0px; top: 2px'></div>").append($s);
                    row.$elm.append($d); // show them

                    hideContext.$selects = hideContext.$selects.add($s); // keep ref
                    hideContext.$added = hideContext.$added.add($d); // keep ref
                });
                
                var $ctrl =  $("<div style='position:absolute; bottom: 2px'></div>");
                var $grp = $("<input type='checkbox'>").change(function() {
                    if ($grp.attr('checked') === 'checked') {       // if grp-selects ON
                        hideContext.$selects.attr('checked','checked'); // set all selects ON
                    } else {
                        hideContext.$selects.removeAttr('checked');     // set all selects OFF
                    }
                });
                var $ok = $("<button>o</button>").click(function() {
                    doTool();
                    endTool();
                });
                var $cancel = $("<button>c</button>").click(function() {
                    endTool();
                });
                $ctrl.append($grp).append($ok).append($cancel);
                api.addToElement("north-west", $ctrl);
                hideContext.$added = hideContext.$added.add($ctrl);
            }
            
            function hideSelectors() {
                hideContext.$added.remove();
            }
            
            
            function startTool() {
                $tool.addClass('pressed');
                hideContext = {
                    '$selects': $([]), 
                    '$added': $([])
                };
                
                showSelectors();
            }
            
            function endTool() {
                hideSelectors();

                hideContext = null;
                $tool.removeClass('pressed');
            }
            
            function doTool() {
                hideContext.$selects.each(function() {
                    var $this = $(this);
                    if (!$this.attr('checked')) { return; }
                    
                    var row = $this.data('row');
                    api.removeRow(row);
                });
            }
            
            //tool-toggle-control
            if (!hideContext) {
                startTool();
            } else {
                endTool();
            }
        }


        $(document).ready( function() {
            var $pb = $('div#planboard');
            $pb.planboard({
                "uri": {
                    "rowdata":          "./data/ve.json", 
                    "period":           "./data/period.json", 
                    "allocation":       "./data/reservation.json",
                    "datePickerImgSrc": "./image/date.png"
                },
                "allocRowProperty":   "ve"
            });
            var api = $pb.data('planboard');
            var $t = $("<button class='tool'>H</button>").click(function(){hideRowsTool( api, $(this));});
            api.addToElement("tools", $t);
        });
    }(jQuery));
  </script>

</HEAD>
<BODY>
    <P>Now here is a fine planboard if you ask me:
    <DIV ID="planboard">no planboard yet</DIV>
</BODY>
</HTML>
